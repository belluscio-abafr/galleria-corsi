{{ define "main" }}
<div class="projects-container">
    <article class="tag-page-intro">
        <!-- Navigation tra tutti i tag -->
        <div class="category-filter-simple">
            <label>Filtra per tema:</label>
            <div class="tags-list">
                {{ $currentTag := .Data.Term }}
                {{ $allTags := slice }}
                {{ range site.Pages }}
                    {{ if eq .Section "projects" }}
                        {{ range .Params.tags }}
                            {{ $allTags = $allTags | append . }}
                        {{ end }}
                    {{ end }}
                {{ end }}
              {{ range ($allTags | uniq | sort) }}
                  {{ if eq . $currentTag }}
                      <span class="tag-link tag-active">{{ . | title }}</span>
                  {{ else }}
                      <a href="/tags/{{ . | urlize }}/" class="tag-link">{{ . | title }}</a>
                  {{ end }}
              {{ end }}
            </div>
        </div>
    </article>

    <!-- Griglia dei progetti con questo tag -->
    <section class="projects-grid">
        {{ if .Pages }}
            {{ range .Pages }}
                {{ $project := . }}
                <article class="project-card">
                    <a href="{{ .RelPermalink }}" class="project-link">
                        {{ with .Params.copertina }}
                            <div class="project-image">
                                <img src="{{ $project.RelPermalink }}{{ . }}" alt="{{ $project.Params.titolo | default $project.Title }}" loading="lazy">
                            </div>
                        {{ end }}
                        <div class="project-info">
                            <h3 class="project-title">{{ .Params.titolo | default .Title }}</h3>
                            <p class="project-student">{{ .Params.studente }}</p>
                            <p class="project-description">{{ .Params.descrizione | truncate 150 }}</p>
                        </div>
                    </a>
                </article>
            {{ end }}
        {{ else }}
            <div class="no-projects">
                <p>Non sono stati trovati progetti per la categoria <strong>{{ .Title | title }}</strong>.</p>
                <a href='{{ "projects/" | relURL }}' class="btn btn-primary">Torna all'elenco completo</a>
            </div>
        {{ end }}
    </section>
</div>
{{ end }}
